<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snake Game</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #222; }
        canvas { background: #111; display: block; margin: auto; border: 2px solid #fff; box-shadow: 0 0 40px #0f0a; }
        #score { color: #fff; text-align: center; font-size: 1.5em; margin-bottom: 10px; }
        #retry {
            display: none;
            margin: 10px auto 0 auto;
            padding: 8px 24px;
            font-size: 1.2em;
            background: #0f0;
            color: #222;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        #retry:active { background: #0c0; }
    </style>
</head>
<body>
    <div>
        <div id="score">Score: 0</div>
        <button id="retry">Retry</button>
        <canvas id="game" width="400" height="400"></canvas>
    </div>
    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const box = 20;
        let snake = [{x: 9 * box, y: 10 * box}];
        let direction = 'RIGHT';
        let food = {
            x: Math.floor(Math.random() * 20) * box,
            y: Math.floor(Math.random() * 20) * box
        };
        let score = 0;
        let game;
        let isGameOver = false;

        document.addEventListener('keydown', e => {
            // Allow reversal only if snake length is 1
            if (snake.length === 1) {
                if (e.key === 'ArrowLeft') direction = 'LEFT';
                else if (e.key === 'ArrowUp') direction = 'UP';
                else if (e.key === 'ArrowRight') direction = 'RIGHT';
                else if (e.key === 'ArrowDown') direction = 'DOWN';
            } else {
                if (e.key === 'ArrowLeft' && direction !== 'RIGHT') direction = 'LEFT';
                else if (e.key === 'ArrowUp' && direction !== 'DOWN') direction = 'UP';
                else if (e.key === 'ArrowRight' && direction !== 'LEFT') direction = 'RIGHT';
                else if (e.key === 'ArrowDown' && direction !== 'UP') direction = 'DOWN';
            }

            if (e.key === 'Enter') {
                resetGame();
            }
        });

        function drawVignette() {
            let grad = ctx.createRadialGradient(
                canvas.width/2, canvas.height/2, canvas.width/4,
                canvas.width/2, canvas.height/2, canvas.width/2
            );
            grad.addColorStop(0, 'rgba(0,0,0,0)');
            grad.addColorStop(1, 'rgba(0,0,0,0.6)');
            ctx.save();
            ctx.globalCompositeOperation = "source-over";
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.restore();
        }

        function drawRoundedRect(x, y, w, h, r, color, shadow = false) {
            ctx.save();
            if (shadow) {
                ctx.shadowColor = "#0ff";
                ctx.shadowBlur = 8;
            }
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
            ctx.restore();
        }

        function drawGrid() {
            ctx.save();
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            for (let i = 0; i <= canvas.width; i += box) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let j = 0; j <= canvas.height; j += box) {
                ctx.beginPath();
                ctx.moveTo(0, j);
                ctx.lineTo(canvas.width, j);
                ctx.stroke();
            }
            ctx.restore();
        }

        function drawSnake() {
            for (let i = 0; i < snake.length; i++) {
                if (i === 0) {
                    // Head with glow and gradient
                    let grad = ctx.createLinearGradient(snake[i].x, snake[i].y, snake[i].x + box, snake[i].y + box);
                    grad.addColorStop(0, '#0f0');
                    grad.addColorStop(1, '#0ff');
                    drawRoundedRect(snake[i].x, snake[i].y, box, box, 7, grad, true);
                } else {
                    // Body with gradient and shadow
                    let grad = ctx.createLinearGradient(snake[i].x, snake[i].y, snake[i].x + box, snake[i].y + box);
                    grad.addColorStop(0, '#fff');
                    grad.addColorStop(1, '#0ff');
                    drawRoundedRect(snake[i].x, snake[i].y, box, box, 4, grad, true);
                }
            }
        }

        function drawFood() {
            // Glossy ball with highlight
            ctx.save();
            ctx.shadowColor = "#f00";
            ctx.shadowBlur = 16;
            ctx.beginPath();
            ctx.arc(food.x + box/2, food.y + box/2, box/2 - 2, 0, Math.PI * 2);
            let grad = ctx.createRadialGradient(
                food.x + box/2, food.y + box/2, box/4,
                food.x + box/2, food.y + box/2, box/2
            );
            grad.addColorStop(0, "#fff");
            grad.addColorStop(0.4, "#f44");
            grad.addColorStop(1, "#f00");
            ctx.fillStyle = grad;
            ctx.fill();
            // Highlight
            ctx.beginPath();
            ctx.arc(food.x + box/2 - 4, food.y + box/2 - 4, 4, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(255,255,255,0.7)";
            ctx.fill();
            ctx.restore();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            drawVignette();
            drawSnake();
            drawFood();

            // Snake head position
            let headX = snake[0].x;
            let headY = snake[0].y;

            if (direction === 'LEFT') headX -= box;
            if (direction === 'UP') headY -= box;
            if (direction === 'RIGHT') headX += box;
            if (direction === 'DOWN') headY += box;

            // Check collision with food
            if (headX === food.x && headY === food.y) {
                score++;
                document.getElementById('score').textContent = 'Score: ' + score;
                food = {
                    x: Math.floor(Math.random() * 20) * box,
                    y: Math.floor(Math.random() * 20) * box
                };
            } else {
                snake.pop();
            }

            // Add new head
            const newHead = {x: headX, y: headY};

            // Game over conditions
            if (
                headX < 0 || headX >= canvas.width ||
                headY < 0 || headY >= canvas.height ||
                snake.some(segment => segment.x === newHead.x && segment.y === newHead.y)
            ) {
                clearInterval(game);
                document.getElementById('score').textContent += ' - Game Over!';
                document.getElementById('retry').style.display = 'block';
                isGameOver = true;
                return;
            }

            snake.unshift(newHead);
        }

        function resetGame() {
            snake = [{x: 9 * box, y: 10 * box}];
            direction = 'RIGHT';
            food = {
                x: Math.floor(Math.random() * 20) * box,
                y: Math.floor(Math.random() * 20) * box
            };
            score = 0;
            document.getElementById('score').textContent = 'Score: ' + score;
            document.getElementById('retry').style.display = 'none';
            isGameOver = false;
            clearInterval(game);
            game = setInterval(draw, 180);
        }

        document.getElementById('retry').onclick = resetGame;

        // Start game
        game = setInterval(draw, 180);
    </script>
</body>
</html>
